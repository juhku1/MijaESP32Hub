#ifndef WEBSERVER_H
#define WEBSERVER_H

// HTML-sivu BLE-skannerin web-k√§ytt√∂liittym√§lle
const char HTML_PAGE[] = 
"<!DOCTYPE html>"
"<html>"
"<head>"
"<meta charset='UTF-8'>"
"<meta name='viewport' content='width=device-width,initial-scale=1.0'>"
"<title>BLE Laitteet</title>"
"<style>"
"*{margin:0;padding:0;box-sizing:border-box}"
"body{font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;"
"background:#0f172a;min-height:100vh;padding:20px;color:#e2e8f0}"
".container{max-width:1000px;margin:0 auto}"
".header{display:flex;justify-content:space-between;align-items:center;margin-bottom:32px;"
"padding:24px;background:linear-gradient(135deg,#1e293b 0%,#334155 100%);"
"border-radius:16px;box-shadow:0 4px 24px rgba(0,0,0,0.4)}"
"h1{color:#f1f5f9;font-size:28px;margin:0;font-weight:700;letter-spacing:-0.5px;"
"display:flex;align-items:center;gap:12px}"
"h1::before{content:'üì°';font-size:32px}"
".toggle-btn{background:#334155;color:#e2e8f0;border:1px solid #475569;"
"padding:10px 20px;border-radius:8px;cursor:pointer;font-size:14px;font-weight:600;"
"transition:all 0.2s;box-shadow:0 2px 8px rgba(0,0,0,0.2)}"
".toggle-btn:hover{background:#475569;border-color:#64748b;transform:translateY(-1px);"
"box-shadow:0 4px 12px rgba(0,0,0,0.3)}"
".toggle-btn.active{background:#3b82f6;border-color:#3b82f6;color:white}"
".device-card{background:#1e293b;border:1px solid #334155;border-radius:12px;padding:24px;"
"margin-bottom:16px;box-shadow:0 2px 16px rgba(0,0,0,0.3);position:relative;transition:all 0.2s;z-index:1}"
".device-card.settings-open{z-index:100}"
".device-card:hover{border-color:#475569;box-shadow:0 4px 24px rgba(0,0,0,0.4);transform:translateY(-2px)}"
".device-card.unsaved{border:2px dashed #10b981;background:#0a3428}"
".device-card.unsaved .device-name::after{content:' (ei tallennettu)';font-size:12px;color:#10b981;font-weight:400}"
".device-header{display:flex;justify-content:space-between;align-items:flex-start}"
".device-info{flex:1}"
".device-name{font-size:18px;font-weight:700;color:#f1f5f9;margin-bottom:6px;letter-spacing:-0.3px}"
".device-mac{font-family:'JetBrains Mono','Courier New',monospace;font-size:12px;color:#64748b;"
"background:#0f172a;padding:4px 8px;border-radius:4px;display:inline-block;margin-top:4px}"
".settings-icon{background:none;border:none;font-size:24px;cursor:pointer;padding:8px;"
"color:#64748b;transition:all 0.2s;border-radius:8px}"
".settings-icon:hover{color:#e2e8f0;background:#334155;transform:rotate(90deg)}"
".settings-panel{display:none;position:absolute;right:16px;top:60px;background:#1e293b;"
"border:1px solid #334155;border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,0.5);"
"min-width:240px;z-index:9999}"
".settings-panel.open{display:block}"
".settings-option{padding:12px 16px;cursor:pointer;transition:background 0.2s;"
"border-bottom:1px solid #334155;color:#e2e8f0}"
".settings-option:last-child{border-bottom:none}"
".settings-option:hover{background:#334155}"
".settings-option.danger{color:#f87171}"
".settings-option.danger:hover{background:#450a0a;color:#fca5a5}"
".sensor-data{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));"
"gap:16px;margin-top:20px;padding-top:20px;border-top:1px solid #334155}"
".sensor-value{text-align:center;background:#0f172a;padding:16px;border-radius:8px;"
"border:1px solid #1e293b;transition:all 0.2s}"
".sensor-value:hover{border-color:#334155;transform:translateY(-2px)}"
".sensor-value.primary{grid-column:span 1;background:linear-gradient(135deg,#1e293b,#334155);"
"border:2px solid #3b82f6;padding:20px}"
".sensor-label{font-size:11px;color:#94a3b8;text-transform:uppercase;letter-spacing:0.8px;"
"margin-bottom:8px;font-weight:600}"
".sensor-value.primary .sensor-label{font-size:12px;color:#60a5fa;font-weight:700}"
".sensor-number{font-size:26px;font-weight:700;color:#3b82f6}"
".sensor-value.primary .sensor-number{font-size:42px;color:#60a5fa;text-shadow:0 0 20px rgba(96,165,250,0.3)}"
".sensor-unit{font-size:13px;color:#64748b;margin-left:2px;font-weight:500}"
".sensor-value.primary .sensor-unit{font-size:18px;color:#93c5fd}"
".temp-cold{color:#60a5fa !important}"
".temp-cool{color:#34d399 !important}"
".temp-normal{color:#fbbf24 !important}"
".temp-warm{color:#fb923c !important}"
".temp-hot{color:#f87171 !important}"
".battery-container{display:flex;flex-direction:column;align-items:center;gap:8px}"
".battery-bar{width:80px;height:22px;border:2px solid #475569;border-radius:6px;position:relative;"
"background:#0f172a;overflow:hidden}"
".battery-bar::after{content:'';position:absolute;top:50%;right:-7px;transform:translateY(-50%);"
"width:4px;height:12px;background:#475569;border-radius:0 3px 3px 0}"
".battery-fill{height:100%;border-radius:3px;transition:width 0.3s,background 0.3s}"
".battery-fill.high{background:linear-gradient(90deg,#10b981,#34d399)}"
".battery-fill.medium{background:linear-gradient(90deg,#f59e0b,#fbbf24)}"
".battery-fill.low{background:linear-gradient(90deg,#ef4444,#f87171)}"
".signal-container{display:flex;align-items:center;gap:8px;justify-content:center}"
".signal-bars{display:flex;align-items:flex-end;gap:3px;height:20px}"
".signal-bar{width:5px;border-radius:2px;transition:background 0.3s}"
".signal-bar:nth-child(1){height:25%}"
".signal-bar:nth-child(2){height:50%}"
".signal-bar:nth-child(3){height:75%}"
".signal-bar:nth-child(4){height:100%}"
".signal-bar.active.excellent,.signal-bar.active.good{background:#10b981}"
".signal-bar.active.fair{background:#f59e0b}"
".signal-bar.active.poor{background:#ef4444}"
".signal-bar.inactive{background:#334155}"
".rssi{display:inline-block;margin-top:12px;padding:6px 12px;background:#0f172a;"
"border-radius:6px;font-size:12px;color:#94a3b8;border:1px solid #1e293b}"
".no-devices{text-align:center;padding:60px 20px;color:#64748b;font-size:18px;font-weight:500}"
".modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;"
"background:rgba(0,0,0,0.8);backdrop-filter:blur(4px)}"
".modal.show{display:flex;align-items:center;justify-content:center}"
".modal-content{background:#1e293b;border-radius:16px;max-width:800px;width:90%;"
"max-height:80vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,0.6);"
"border:1px solid #334155}"
".modal-header{padding:24px;border-bottom:1px solid #334155;display:flex;"
"justify-content:space-between;align-items:center}"
".modal-header h2{color:#f1f5f9;font-size:24px;margin:0}"
".modal-close{background:none;border:none;font-size:32px;color:#64748b;"
"cursor:pointer;padding:0;width:40px;height:40px;border-radius:8px;"
"transition:all 0.2s}"
".modal-close:hover{background:#334155;color:#f1f5f9}"
".modal-body{padding:24px}"
".discovery-device{background:#0f172a;border:1px solid #334155;border-radius:12px;"
"padding:20px;margin-bottom:12px;display:flex;justify-content:space-between;"
"align-items:center;transition:all 0.2s}"
".discovery-device:hover{border-color:#475569;background:#1a1f2e}"
".discovery-info h3{color:#f1f5f9;font-size:16px;margin-bottom:4px}"
".discovery-info p{color:#64748b;font-size:13px}"
".add-btn{background:#10b981;color:white;border:none;padding:10px 20px;"
"border-radius:8px;cursor:pointer;font-weight:600;transition:all 0.2s}"
".add-btn:hover{background:#059669;transform:translateY(-1px)}"
".add-btn:disabled{background:#334155;color:#64748b;cursor:not-allowed;transform:none}"
"</style>"
"</head>"
"<body>"
"<div class='container'>"
"<div class='header'>"
"<h1>BLE-laitteet</h1>"
"<div style='display:flex;gap:12px;'>"
"<button class='toggle-btn' id='scanBtn' onclick='openDiscovery()'>üîç L√∂yd√§ laitteita</button>"
"<button class='toggle-btn' onclick='openAioSettings()'>‚òÅÔ∏è Pilvi</button>"
"</div>"
"</div>"
"<div id='devices'></div>"
"</div>"
"<div id='discoveryModal' class='modal'>"
"<div class='modal-content'>"
"<div class='modal-header'>"
"<h2>üîç L√∂ydetyt laitteet</h2>"
"<button class='modal-close' onclick='closeDiscovery()'>√ó</button>"
"</div>"
"<div class='modal-body'>"
"<div id='discoveryDevices'></div>"
"</div>"
"</div>"
"</div>"
"<script>"
"let openSettings=null;"
"let scanCountdown=0;"
"let scanInterval=null;"
"let discoveryInterval=null;"
"async function openDiscovery(){"
"document.getElementById('discoveryModal').classList.add('show');"
"await startScan();"
"updateDiscoveryDevices();"
"discoveryInterval=setInterval(updateDiscoveryDevices,2000);}"
"function closeDiscovery(){"
"document.getElementById('discoveryModal').classList.remove('show');"
"if(discoveryInterval){clearInterval(discoveryInterval);discoveryInterval=null;}}"
"async function startScan(){"
"const btn=document.getElementById('scanBtn');"
"btn.disabled=true;"
"btn.textContent='‚è≥ K√§ynnistet√§√§n...';"
"try{"
"const resp=await fetch('/api/start-scan',{method:'POST'});"
"const result=await resp.json();"
"if(result.ok){"
"scanCountdown=result.duration;"
"btn.textContent='‚è≥ Skannaa ('+scanCountdown+'s)';"
"scanInterval=setInterval(()=>{"
"scanCountdown--;"
"if(scanCountdown<=0){"
"clearInterval(scanInterval);"
"btn.textContent='üîç L√∂yd√§ laitteita';"
"btn.disabled=false;"
"}else{"
"btn.textContent='‚è≥ Skannaa ('+scanCountdown+'s)';}"
"},1000);"
"}else{"
"alert('Skannauksen k√§ynnistys ep√§onnistui: '+result.error);"
"btn.textContent='üîç L√∂yd√§ laitteita';"
"btn.disabled=false;}"
"}catch(err){"
"console.error('Virhe:',err);"
"alert('Virhe skannauksen k√§ynnistyksess√§!');"
"btn.textContent='üîç L√∂yd√§ laitteita';"
"btn.disabled=false;}}"
"async function updateDiscoveryDevices(){"
"try{"
"const res=await fetch('/api/devices?all=1');"
"const data=await res.json();"
"const container=document.getElementById('discoveryDevices');"
"if(data.length===0){container.innerHTML='<div class=\"no-devices\">Ei l√∂ydetty laitteita</div>';return;}"
"let html='';"
"data.forEach(d=>{"
"const name=d.name||'Nimet√∂n laite';"
"const addr=d.addr;"
"const isAdded=d.saved;"
"html+='<div class=\"discovery-device\">';"
"html+='<div class=\"discovery-info\">';"
"html+='<h3>'+name+'</h3>';"
"html+='<p>'+addr;"
"if(d.hasSensor)html+=' ‚Ä¢ üå°Ô∏è '+d.temp.toFixed(1)+'¬∞C ‚Ä¢ üíß '+d.hum+'%';"
"html+='</p></div>';"
"if(isAdded){"
"html+='<button class=\"add-btn\" disabled>‚úì Lis√§tty</button>';"
"}else{"
"html+='<button class=\"add-btn\" onclick=\"addToMain(\\''+addr+'\\');\">+ Lis√§√§</button>';}"
"html+='</div>';});"
"container.innerHTML=html;"
"}catch(err){console.error('Virhe:',err);}}"
"async function addToMain(addr){"
"try{"
"const resp=await fetch('/api/toggle-visibility',{method:'POST',"
"headers:{'Content-Type':'application/x-www-form-urlencoded'},"
"body:'addr='+encodeURIComponent(addr)+'&visible=1'});"
"const result=await resp.json();"
"if(result.ok){"
"updateDiscoveryDevices();"
"updateDevices();"
"}else{alert('Virhe lis√§yksess√§');}"
"}catch(err){console.error('Virhe:',err);}}"
"function toggleSettings(addr){"
"const panel=document.getElementById('settings-'+addr);"
"const card=panel?panel.closest('.device-card'):null;"
"if(openSettings&&openSettings!==panel){"
"openSettings.classList.remove('open');"
"const oldCard=openSettings.closest('.device-card');"
"if(oldCard)oldCard.classList.remove('settings-open');}"
"if(panel){"
"panel.classList.toggle('open');"
"const isOpen=panel.classList.contains('open');"
"openSettings=isOpen?panel:null;"
"if(card)card.classList.toggle('settings-open',isOpen);}}"
"document.addEventListener('click',(e)=>{"
"if(!e.target.closest('.settings-icon')&&!e.target.closest('.settings-panel')){"
"if(openSettings){"
"openSettings.classList.remove('open');"
"const card=openSettings.closest('.device-card');"
"if(card)card.classList.remove('settings-open');"
"openSettings=null;}}});"
"async function hideDevice(addr,event){"
"if(event){event.stopPropagation();}"
"console.log('Poistetaan laite p√§√§n√§kym√§st√§:',addr);"
"if(openSettings){openSettings.classList.remove('open');openSettings=null;}"
"try{"
"const resp=await fetch('/api/toggle-visibility',{method:'POST',"
"headers:{'Content-Type':'application/x-www-form-urlencoded'},"
"body:'addr='+encodeURIComponent(addr)+'&visible=0'});"
"const result=await resp.json();"
"console.log('Vastaus:',result);"
"setTimeout(updateDevices,100);"
"}catch(err){console.error('Virhe:',err);}}"
"async function showDevice(addr,event){"
"if(event){event.stopPropagation();}"
"console.log('Lis√§t√§√§n laite p√§√§n√§kym√§√§n:',addr);"
"if(openSettings){openSettings.classList.remove('open');openSettings=null;}"
"try{"
"const resp=await fetch('/api/toggle-visibility',{method:'POST',"
"headers:{'Content-Type':'application/x-www-form-urlencoded'},"
"body:'addr='+encodeURIComponent(addr)+'&visible=1'});"
"const result=await resp.json();"
"console.log('Vastaus:',result);"
"setTimeout(updateDevices,100);"
"}catch(err){console.error('Virhe:',err);}}"
"async function saveSettings(addr,addrClean,applyToSimilar,event){"
"if(event){event.stopPropagation();}"
"const name=document.getElementById('name-'+addrClean).value;"
"const showMac=document.getElementById('showmac-'+addrClean).checked?1:0;"
"let fieldMask=0;"
"document.querySelectorAll('#settings-'+addrClean+' .field-check').forEach(cb=>{"
"if(cb.checked){fieldMask|=parseInt(cb.getAttribute('data-bit'));}});"
"console.log('Tallennetaan:',addr,'name=',name,'showMac=',showMac,'fields=',fieldMask,'apply=',applyToSimilar);"
"try{"
"const resp=await fetch('/api/update-settings',{method:'POST',"
"headers:{'Content-Type':'application/x-www-form-urlencoded'},"
"body:'addr='+encodeURIComponent(addr)+'&name='+encodeURIComponent(name)+'&show_mac='+showMac+'&field_mask='+fieldMask+'&apply_to_similar='+(applyToSimilar?1:0)});"
"const result=await resp.json();"
"console.log('Vastaus:',result);"
"if(result.updated>1){"
"alert('Asetukset tallennettu '+result.updated+' laitteelle!');"
"}else{"
"alert('Asetukset tallennettu!');}"
"if(openSettings){openSettings.classList.remove('open');openSettings=null;}"
"setTimeout(updateDevices,100);"
"}catch(err){console.error('Virhe:',err);alert('Virhe tallennettaessa!');}}"
"async function updateDevices(){"
"if(openSettings){console.log('Asetukset auki, ohitetaan p√§ivitys');return;}"
"try{"
"const url='/api/devices';"
"const res=await fetch(url);"
"const data=await res.json();"
"console.log('L√∂ydetty',data.length,'laitetta');"
"if(data.length===0){document.getElementById('devices').innerHTML="
"'<div class=\"no-devices\">Ei n√§ytett√§vi√§ laitteita</div>';return;}"
"let html='';"
"data.forEach(d=>{"
"const name=d.name||'Nimet√∂n laite';"
"const addrClean=d.addr.replace(/:/g,'');"
"const savedClass=d.saved?'':'unsaved';"
"html+='<div class=\"device-card '+savedClass+'\">'"
"+' <div class=\"device-header\">'"
"+' <div class=\"device-info\">'"
"+' <div class=\"device-name\">'+name+'</div>';"
"if(d.showMac){"
"html+=' <div class=\"device-mac\">'+d.addr+'</div>';}"
"html+=' </div>'"
"+' <button class=\"settings-icon\" onclick=\"toggleSettings(\\''+addrClean+'\\')\" >‚öôÔ∏è</button>'"
"+' <div class=\"settings-panel\" id=\"settings-'+addrClean+'\">';"
"html+=' <div style=\"padding:14px;\">'"
"+' <label style=\"display:block;margin-bottom:6px;font-weight:600;color:#f1f5f9;font-size:13px;\">Nimi:</label>'"
"+' <input type=\"text\" id=\"name-'+addrClean+'\" value=\"'+name+'\" style=\"width:100%;padding:8px;margin-bottom:12px;border:1px solid #475569;border-radius:6px;background:#0f172a;color:#e2e8f0;font-size:14px;\" />'"
"+' <label style=\"display:flex;align-items:center;margin-bottom:12px;color:#e2e8f0;cursor:pointer;\">'"
"+' <input type=\"checkbox\" id=\"showmac-'+addrClean+'\" '+(d.showMac?'checked':'')+' style=\"margin-right:8px;cursor:pointer;\" />'"
"+' <span style=\"font-size:13px;\">N√§yt√§ MAC-osoite</span>'"
"+' </label>'"
"+' <div style=\"margin-bottom:10px;font-weight:600;color:#f1f5f9;font-size:13px;\">N√§ytett√§v√§t kent√§t:</div>';"
"const fields=[{bit:1,label:'L√§mp√∂tila'},{bit:2,label:'Kosteus'},{bit:4,label:'Akku %'},{bit:8,label:'J√§nnite'},{bit:16,label:'Signaali'}];"
"fields.forEach(f=>{"
"const available=(d.availableFields&f.bit)!==0;"
"const checked=(d.fieldMask&f.bit)!==0;"
"if(available){"
"html+=' <label style=\"display:flex;align-items:center;margin-bottom:6px;color:#e2e8f0;cursor:pointer;\">'"
"+' <input type=\"checkbox\" class=\"field-check\" data-bit=\"'+f.bit+'\" '+(checked?'checked':'')+' style=\"margin-right:8px;cursor:pointer;\" />'"
"+' <span style=\"font-size:13px;\">'+f.label+'</span> </label>';}});"
"html+=' <button onclick=\"saveSettings(\\''+d.addr+'\\',\\''+addrClean+'\\',false,event)\" style=\"width:100%;padding:10px;margin-top:14px;background:#3b82f6;color:white;border:none;border-radius:6px;cursor:pointer;font-weight:600;font-size:13px;transition:background 0.2s;\" onmouseover=\"this.style.background=\\'#2563eb\\'\" onmouseout=\"this.style.background=\\'#3b82f6\\'\">üíæ Tallenna</button>'"
"+' <button onclick=\"saveSettings(\\''+d.addr+'\\',\\''+addrClean+'\\',true,event)\" style=\"width:100%;padding:10px;margin-top:6px;background:#10b981;color:white;border:none;border-radius:6px;cursor:pointer;font-weight:600;font-size:13px;transition:background 0.2s;\" onmouseover=\"this.style.background=\\'#059669\\'\" onmouseout=\"this.style.background=\\'#10b981\\'\">üîÅ Sovella samanlaisiin</button>';"
"if(d.saved){"
"html+=' <div class=\"settings-option danger\" onclick=\"hideDevice(\\''+d.addr+'\\',event)\" style=\"margin-top:10px;\">‚ûñ Poista p√§√§n√§kym√§st√§</div>';"
"}else{"
"html+=' <div class=\"settings-option\" onclick=\"showDevice(\\''+d.addr+'\\',event)\" style=\"margin-top:10px;background:#10b981;\">üíæ Tallenna p√§√§n√§kym√§√§n</div>';}"
"html+=' </div></div>'"
"+' </div>';"
"if(d.hasSensor){"
"html+=' <div class=\"sensor-data\">';"
"if((d.fieldMask&1)&&d.temp){"
"let tempClass='temp-normal';"
"if(d.temp<10)tempClass='temp-cold';"
"else if(d.temp<18)tempClass='temp-cool';"
"else if(d.temp>26)tempClass='temp-warm';"
"else if(d.temp>30)tempClass='temp-hot';"
"html+=' <div class=\"sensor-value primary\">'"
"+' <div class=\"sensor-label\">üå°Ô∏è L√§mp√∂tila</div>'"
"+' <div class=\"sensor-number '+tempClass+'\">'+d.temp.toFixed(1)+'<span class=\"sensor-unit\">¬∞C</span></div>'"
"+' </div>';}"
"if((d.fieldMask&2)&&d.hum){"
"html+=' <div class=\"sensor-value\">'"
"+' <div class=\"sensor-label\">üíß Kosteus</div>'"
"+' <div class=\"sensor-number\">'+d.hum+'<span class=\"sensor-unit\">%</span></div>'"
"+' </div>';}"
"if((d.fieldMask&4)&&d.bat){"
"const batClass=d.bat>50?'high':(d.bat>20?'medium':'low');"
"html+=' <div class=\"sensor-value\">'"
"+' <div class=\"sensor-label\">üîã Akku</div>'"
"+' <div class=\"battery-container\">'"
"+' <div class=\"battery-bar\"><div class=\"battery-fill '+batClass+'\" style=\"width:'+d.bat+'%\"></div></div>'"
"+' <div class=\"sensor-number\" style=\"font-size:18px;\">'+d.bat+'%</div>'"
"+' </div>'"
"+' </div>';}"
"if((d.fieldMask&8)&&d.batMv){"
"html+=' <div class=\"sensor-value\">'"
"+' <div class=\"sensor-label\">‚ö° J√§nnite</div>'"
"+' <div class=\"sensor-number\">'+d.batMv+'<span class=\"sensor-unit\">mV</span></div>'"
"+' </div>';}"
"html+=' </div>';}"
"if(d.fieldMask&16){"
"let barCount=0,signalClass='';"
"if(d.rssi>=-50){barCount=4;signalClass='excellent';}"
"else if(d.rssi>=-65){barCount=3;signalClass='good';}"
"else if(d.rssi>=-75){barCount=2;signalClass='fair';}"
"else{barCount=1;signalClass='poor';}"
"html+=' <div class=\"rssi\"><div class=\"signal-container\">'"
"+' <div class=\"signal-bars\">';"
"for(let i=1;i<=4;i++){"
"html+='<div class=\"signal-bar '+(i<=barCount?'active '+signalClass:'inactive')+'\"></div>';}"
"html+=' </div><span style=\"font-size:13px;color:#7f8c8d;\">'+d.rssi+' dBm</span></div></div>';}"
"html+='</div>';});"
"document.getElementById('devices').innerHTML=html;"
"}catch(error){console.error('Virhe haettaessa laitteita:',error);}}"
"setInterval(updateDevices,2000);updateDevices();"
"async function openAioSettings(){"
"const modal=document.getElementById('aioModal');modal.style.display='flex';"
"try{const r=await fetch('/api/aio/config');const d=await r.json();"
"if(d.ok){document.getElementById('aioUser').value=d.username||'';"
"document.getElementById('aioEnabled').checked=d.enabled;"
"const types=d.feedTypes||3;"
"document.getElementById('feedTemp').checked=(types&1)!==0;"
"document.getElementById('feedHum').checked=(types&2)!==0;"
"document.getElementById('feedBat').checked=(types&4)!==0;"
"window.oldFeedTypes=types;}}"
"catch(e){console.error('Virhe ladattaessa AIO-asetuksia:',e);}}"
"function closeAioSettings(){document.getElementById('aioModal').style.display='none';}"
"async function saveAioSettings(){"
"const user=document.getElementById('aioUser').value;"
"const key=document.getElementById('aioKey').value;"
"const enabled=document.getElementById('aioEnabled').checked;"
"if(!user||!key){alert('T√§yt√§ k√§ytt√§j√§nimi ja avain!');return;}"
"const feedTypes=3;"
"try{const r=await fetch('/api/aio/config',{method:'POST',headers:{'Content-Type':'application/json'},"
"body:JSON.stringify({username:user,key:key,enabled:enabled,feedTypes:feedTypes})});"
"const d=await r.json();if(d.ok){alert('Asetukset tallennettu!\\n\\nValitse datatyypit ja luo feedit Ohje-popupissa.');closeAioSettings();}else{alert('Virhe: '+d.error);}}"
"catch(e){alert('Virhe tallennettaessa: '+e.message);}}"
"async function sendAioNow(){"
"try{const r=await fetch('/api/aio/send_now',{method:'POST'});"
"const d=await r.json();if(d.ok){alert('L√§hetys aloitettu! Tarkista Adafruit IO muutaman sekunnin kuluttua.');}else{alert('Virhe: '+(d.error||'Tuntematon'));}}"
"catch(e){alert('Virhe: '+e.message);}}"
"async function createAioFeeds(){"
"const temp=document.getElementById('feedTemp').checked;"
"const hum=document.getElementById('feedHum').checked;"
"const bat=document.getElementById('feedBat').checked;"
"if(!temp&&!hum&&!bat){alert('Valitse v√§hint√§√§n yksi datatyyppi ensin!');return;}"
"const feedTypes=(temp?1:0)|(hum?2:0)|(bat?4:0);"
"const oldTypes=window.oldFeedTypes||0;"
"const removed=oldTypes&(~feedTypes);"
"if(removed!==0){"
"const names=[];"
"if(removed&1)names.push('L√§mp√∂tila');"
"if(removed&2)names.push('Kosteus');"
"if(removed&4)names.push('Akku');"
"const msg='‚ö†Ô∏è VAROITUS!\\n\\nPoistat seuraavat datatyypit:\\n‚Ä¢ '+names.join('\\n‚Ä¢ ')+'\\n\\nT√§m√§ POISTAA kaikki vastaavat feedit ja KAIKEN niiden datan PYSYV√ÑSTI!\\n\\nHaluatko varmasti jatkaa?';"
"if(!confirm(msg))return;"
"try{"
"const dr=await fetch('/api/aio/delete_feeds?types='+removed,{method:'DELETE'});"
"const dd=await dr.json();"
"if(!dd.ok){alert('Feedien poisto ep√§onnistui: '+dd.error);return;}"
"alert('Poistettiin '+dd.deleted+' feedi√§');"
"}catch(e){alert('Virhe poistettaessa: '+e.message);return;}}"
"try{"
"const user=document.getElementById('aioUser').value;"
"const key=document.getElementById('aioKey').value;"
"if(!user||!key){alert('Sy√∂t√§ ensin k√§ytt√§j√§nimi ja AIO Key Pilvi-asetuksiin!');return;}"
"const r2=await fetch('/api/aio/config',{method:'POST',headers:{'Content-Type':'application/json'},"
"body:JSON.stringify({username:user,key:key,enabled:true,feedTypes:feedTypes})});"
"const d2=await r2.json();"
"if(!d2.ok){alert('Asetusten tallennus ep√§onnistui');return;}"
"window.oldFeedTypes=feedTypes;"
"}catch(e){alert('Virhe: '+e.message);return;}"
"if(!confirm('Luodaanko feedit automaattisesti kaikille n√§kyville laitteille?'))return;"
"const btn=event.target;btn.disabled=true;btn.textContent='‚è≥ Luodaan...';"
"try{const r=await fetch('/api/aio/create_feeds',{method:'POST'});"
"const d=await r.json();if(d.ok){alert('‚úÖ Luotiin '+d.count+' feedi√§!\\n\\nNyt voit testata l√§hetyst√§.');}else{alert('Virhe: '+(d.error||'Tuntematon'));}"
"btn.disabled=false;btn.textContent='üîß Luo feedit automaattisesti';}"
"catch(e){alert('Virhe: '+e.message);btn.disabled=false;btn.textContent='üîß Luo feedit automaattisesti';}}"
"function updateFeedCount(){"
"const temp=document.getElementById('feedTemp').checked;"
"const hum=document.getElementById('feedHum').checked;"
"const bat=document.getElementById('feedBat').checked;"
"const types=(temp?1:0)+(hum?1:0)+(bat?1:0);"
"const label=document.getElementById('feedCountLabel');"
"if(types>0){label.textContent='Arvio: '+(5*types)+' feedi√§ 5 laitteella';"
"label.style.color=types<=2?'#10b981':'#f59e0b';}else{label.textContent='Valitse datatyypit';"
"label.style.color='#94a3b8';}}"
"function openAioHelp(){"
"document.getElementById('aioHelpModal').classList.add('show');}"
"function closeAioHelp(){"
"document.getElementById('aioHelpModal').classList.remove('show');}"
"</script>"
"<div id='aioModal' class='modal'><div class='modal-content'>"
"<div class='modal-header'><h2>‚òÅÔ∏è Adafruit IO</h2>"
"<button class='modal-close' onclick='closeAioSettings()'>√ó</button></div>"
"<div style='padding:20px;'>"
"<button onclick='openAioHelp()' style='width:100%;padding:12px;background:#6366f1;color:white;border:none;border-radius:8px;font-weight:600;cursor:pointer;margin-bottom:20px;'>üìñ N√§yt√§ k√§ytt√∂√∂notto-ohjeet</button>"
"<div style='margin-bottom:15px;'><label style='display:block;margin-bottom:5px;font-weight:600;'>K√§ytt√§j√§nimi:</label>"
"<input type='text' id='aioUser' placeholder='esim. juhku' style='width:100%;padding:10px;border:1px solid #334155;border-radius:8px;background:#1e293b;color:#e2e8f0;'></div>"
"<div style='margin-bottom:15px;'><label style='display:block;margin-bottom:5px;font-weight:600;'>AIO Key:</label>"
"<input type='password' id='aioKey' placeholder='aio_...' style='width:100%;padding:10px;border:1px solid #334155;border-radius:8px;background:#1e293b;color:#e2e8f0;'></div>"
"<div style='margin-bottom:20px;'><label style='display:flex;align-items:center;gap:10px;'>"
"<input type='checkbox' id='aioEnabled' style='width:20px;height:20px;'><span>L√§hetys k√§yt√∂ss√§ (5 min v√§lein)</span></label></div>"
"<button onclick='saveAioSettings()' style='width:100%;padding:12px;background:#10b981;color:white;border:none;border-radius:8px;font-weight:600;cursor:pointer;margin-bottom:10px;'>üíæ Tallenna asetukset</button>"
"<button onclick='sendAioNow()' style='width:100%;padding:12px;background:#3b82f6;color:white;border:none;border-radius:8px;font-weight:600;cursor:pointer;'>üì§ L√§het√§ nyt (testi)</button>"
"</div></div></div>"
"<div id='aioHelpModal' class='modal'><div class='modal-content' style='max-width:700px;'>"
"<div class='modal-header'><h2>üìñ Adafruit IO K√§ytt√∂√∂notto</h2>"
"<button class='modal-close' onclick='closeAioHelp()'>√ó</button></div>"
"<div style='padding:24px;'>"
"<div style='background:#0f172a;border:1px solid #334155;border-radius:12px;padding:20px;margin-bottom:20px;'>"
"<h3 style='margin-bottom:15px;color:#f1f5f9;font-size:18px;'>Vaiheittainen ohje</h3>"
"<ol style='margin-left:20px;line-height:2.2;color:#cbd5e1;font-size:15px;'>"
"<li>Luo <strong>ilmainen tili</strong> osoitteessa <a href='https://io.adafruit.com' target='_blank' style='color:#60a5fa;text-decoration:underline;'>io.adafruit.com</a></li>"
"<li>Kirjaudu sis√§√§n ja klikkaa <strong>keltaista avain-ikonia (üîë)</strong> oikeassa yl√§kulmassa</li>"
"<li>Kopioi <strong>Username</strong> ja <strong>AIO Key</strong></li>"
"<li>Palaa t√§h√§n sovellukseen, klikkaa <strong>‚òÅÔ∏è Pilvi</strong> ja liit√§ tiedot kenttiin</li>"
"<li><strong>Valitse datatyypit</strong> alla olevista vaihtoehdoista</li>"
"<li>Klikkaa <strong>\"üíæ Tallenna asetukset\"</strong></li>"
"<li>Klikkaa alla olevaa <strong>\"üîß Luo feedit\"</strong> -nappia</li>"
"<li>Feedit luodaan automaattisesti kaikille n√§kyville laitteille</li>"
"<li>Testaa l√§hetyst√§ <strong>\"üì§ L√§het√§ nyt\"</strong> -painikkeella</li>"
"<li>Tarkista <a href='https://io.adafruit.com' target='_blank' style='color:#60a5fa;text-decoration:underline;'>io.adafruit.com</a> ett√§ data n√§kyy feedeiss√§</li>"
"<li>‚úÖ Valmis! Data l√§hetet√§√§n automaattisesti 5 minuutin v√§lein</li>"
"</ol>"
"</div>"
"<div style='background:#1e3a4c;border-left:4px solid #3b82f6;padding:15px;border-radius:8px;margin-bottom:20px;'>"
"<p style='margin:0;font-size:14px;color:#bfdbfe;'><strong>üí° Ilmaisversion rajoitukset:</strong></p>"
"<ul style='margin:10px 0 0 20px;color:#93c5fd;line-height:1.8;'>"
"<li>Maksimi <strong>10 feedi√§</strong> per k√§ytt√§j√§</li>"
"<li>Maksimi <strong>30 viesti√§ minuutissa</strong></li>"
"<li>Valitse datatyypit tarpeen mukaan (temp/hum/bat)</li>"
"</ul>"
"</div>"
"<div style='background:#0f172a;border:1px solid #334155;border-radius:12px;padding:20px;margin-bottom:20px;'>"
"<h3 style='margin-bottom:15px;color:#f1f5f9;font-size:16px;'>Valitse l√§hetett√§v√§t datatyypit:</h3>"
"<label style='display:flex;align-items:center;gap:10px;margin-bottom:10px;color:#e2e8f0;cursor:pointer;'>"
"<input type='checkbox' id='feedTemp' checked onchange='updateFeedCount()' style='width:20px;height:20px;cursor:pointer;'>"
"<span style='font-size:15px;'><strong>üå°Ô∏è L√§mp√∂tila</strong> (suositeltu)</span></label>"
"<label style='display:flex;align-items:center;gap:10px;margin-bottom:10px;color:#e2e8f0;cursor:pointer;'>"
"<input type='checkbox' id='feedHum' checked onchange='updateFeedCount()' style='width:20px;height:20px;cursor:pointer;'>"
"<span style='font-size:15px;'><strong>üíß Kosteus</strong></span></label>"
"<label style='display:flex;align-items:center;gap:10px;margin-bottom:15px;color:#e2e8f0;cursor:pointer;'>"
"<input type='checkbox' id='feedBat' onchange='updateFeedCount()' style='width:20px;height:20px;cursor:pointer;'>"
"<span style='font-size:15px;'><strong>üîã Akku</strong></span></label>"
"<div id='feedCountLabel' style='text-align:center;padding:10px;background:#1e293b;border-radius:8px;color:#10b981;font-weight:600;'>Arvio: 10 feedi√§ 5 laitteella</div>"
"</div>"
"<button onclick='createAioFeeds()' style='width:100%;padding:16px;background:#f59e0b;color:white;border:none;border-radius:10px;font-weight:700;cursor:pointer;font-size:16px;margin-bottom:12px;box-shadow:0 4px 12px rgba(245,158,11,0.3);'>üîß Luo feedit automaattisesti</button>"
"<p style='text-align:center;color:#94a3b8;font-size:13px;margin:0;'>Luo valitut feedit kaikille n√§kyville laitteille yhdell√§ klikkauksella</p>"
"</div></div></div>"
"</body>"
"</html>";

#endif // WEBSERVER_H
